CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
project( CeresSirkaExtrinsicsCalibrator )

######################
# find include dirs:
######################

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_SOURCE_DIR}/cmake/modules")
SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "/usr/local/share/cmake/Modules")

FIND_PACKAGE(PkgConfig)
PKG_CHECK_MODULES(EIGEN3 REQUIRED eigen3>=3.2.3)
PKG_CHECK_MODULES(GLOG REQUIRED libglog)
#FIND_PACKAGE(Eigen3 3.2.3 REQUIRED)

# Hack
SET(CERES_LIBRARIES "/usr/lib/libceres.so.1")
SET(CERES_INCLUDE_DIRS "/usr/lib/ceres")

IF(APPLE)
  FIND_LIBRARY(ACCELERATE Accelerate)
  message(STATUS "Accelerate: " ${ACCELERATE})

  FIND_PACKAGE(Ceres REQUIRED PATHS /usr/lib/ceres)
ELSE(APPLE)
  FIND_PACKAGE(BLAS)
  IF(BLAS_FOUND)
    message("-- Found BLAS library: ${BLAS_LIBRARIES}")
  ENDIF(BLAS_FOUND)
  FIND_PACKAGE(LAPACK REQUIRED)
  IF(LAPACK_FOUND)
    message("-- Found LAPACK library: ${LAPACK_LIBRARIES}")
  ENDIF(LAPACK_FOUND)
  #FIND_PACKAGE(Ceres)
ENDIF(APPLE)

FIND_PACKAGE(Boost 1.36.0 REQUIRED COMPONENTS filesystem program_options unit_test_framework)
#FIND_PACKAGE(protobuf REQUIRED)
#FIND_PACKAGE(glog REQUIRED)
FIND_LIBRARY(GLOG_LIBRARY NAMES ${GLOG_LIBRARIES} HINTS ${GLOG_LIBRARY_DIRS} PATHS "/usr/lib/x86_64-linux-gnu")
message("-- GLOG: ${GLOG_LIBRARY} in ${GLOG_LIBRARY_DIRS}")

INCLUDE_DIRECTORIES(${EIGEN3_INCLUDE_DIR} ${EIGEN3_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${CERES_INCLUDE_DIRS})
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})
INCLUDE_DIRECTORIES(${Boost_INCLUDE_DIRS})

ADD_DEFINITIONS(
  -std=c++1z
)
file(GLOB calibrator_src src/*.cpp src/*.h)

IF(NOT IMU_READING_PREFIX)
  SET(IMU_READING_PREFIX "/usr/local")
ENDIF(NOT IMU_READING_PREFIX)
MESSAGE(STATUS "IMU reading library prefix: " ${IMU_READING_PREFIX})

INCLUDE(${IMU_READING_PREFIX}/lib/imureading/imureading-targets.cmake)
INCLUDE_DIRECTORIES(${IMU_READING_PREFIX}/include/imureading)
ADD_EXECUTABLE( calibrator ${calibrator_src})
IF(APPLE)
  TARGET_LINK_LIBRARIES( calibrator imureading ${ACCELERATE} ${CERES_LIBRARIES} ${Boost_LIBRARIES} ${PROTOBUF_LIBRARIES})
ELSE(APPLE)
	TARGET_LINK_LIBRARIES( calibrator imureading ${LAPACK_LIBRARIES} ${GLOG_LIBRARIES} ${CERES_LIBRARIES} ${Boost_LIBRARIES} ${PROTOBUF_LIBRARIES})
ENDIF(APPLE)
